<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Webrowser ‚Äî Simple Local Browser</title>
		<style>
			:root{--bg:#0f1720;--panel:#0b1220;--accent:#06f;--muted:#9aa6b2;--btn:#122030}
			html,body{height:100%;margin:0;background:var(--bg);color:#e6eef6;font-family:Inter,system-ui,Arial}
			.top{display:flex;gap:8px;padding:10px;background:linear-gradient(90deg,rgba(255,255,255,.02),transparent);align-items:center}
			input.address{flex:1;padding:8px 12px;border-radius:6px;border:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.02);color:inherit}
			button{background:var(--btn);border:1px solid rgba(255,255,255,.04);color:inherit;padding:8px 10px;border-radius:6px;cursor:pointer}
			button:active{transform:translateY(1px)}
			.toolbar{display:flex;gap:6px;align-items:center}
			#status{padding-left:12px;color:var(--muted);font-size:13px}
			.content{height:calc(100% - 58px);display:block}
			iframe#browser{width:100%;height:100%;border:0;background:white}
		</style>
	</head>
	<body>
		<div class="top">
			<div class="toolbar">
				<button id="back" title="Back">‚óÄ</button>
				<button id="forward" title="Forward">‚ñ∂</button>
				<button id="reload" title="Reload">‚ü≥</button>
				<button id="home" title="Home">üè†</button>
			</div>
			<input class="address" id="address" placeholder="Enter URL (e.g. https://example.com)" />
			<button id="go">Go</button>
			<div id="status">Ready</div>
		</div>
		<div class="content">
			<iframe id="browser" src="about:blank" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
		</div>

		<script>
			const address = document.getElementById('address');
			const go = document.getElementById('go');
			const back = document.getElementById('back');
			const fwd = document.getElementById('forward');
			const reload = document.getElementById('reload');
			const home = document.getElementById('home');
			const status = document.getElementById('status');
			const iframe = document.getElementById('browser');

			const HOME_URL = 'https://example.com/';

			let historyStack = [];
			let historyIndex = -1;
			let isNavigatingProgrammatically = false;

			function normalizeInput(input){
				input = input.trim();
				if(!input) return '';
				// If no scheme, assume http
				if(!/^https?:\/\//i.test(input)) input = 'http://' + input;
				return input;
			}

			function proxiedFor(url){
				return '/proxy?url=' + encodeURIComponent(url);
			}

			function navigateTo(url, addToHistory=true){
				if(!url) return;
				const prox = proxiedFor(url);
				isNavigatingProgrammatically = true;
				iframe.src = prox;
				status.textContent = 'Loading...';
				if(addToHistory){
					// trim forward history
					historyStack = historyStack.slice(0, historyIndex + 1);
					historyStack.push(url);
					historyIndex = historyStack.length - 1;
				}
				updateNavButtons();
			}

			function updateNavButtons(){
				back.disabled = historyIndex <= 0;
				fwd.disabled = historyIndex >= historyStack.length - 1;
			}

			go.addEventListener('click', ()=>{
				const u = normalizeInput(address.value);
				if(!u) return;
				navigateTo(u, true);
			});

			address.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') go.click(); });
			back.addEventListener('click', ()=>{ if(historyIndex>0){ historyIndex--; navigateTo(historyStack[historyIndex], false); updateNavButtons(); }});
			fwd.addEventListener('click', ()=>{ if(historyIndex < historyStack.length-1){ historyIndex++; navigateTo(historyStack[historyIndex], false); updateNavButtons(); }});
			reload.addEventListener('click', ()=>{ if(historyIndex>=0) navigateTo(historyStack[historyIndex], false); else iframe.contentWindow.location.reload(); });
			home.addEventListener('click', ()=>{ navigateTo(HOME_URL, true); });

			// When iframe loads, update the address bar and status. Because proxied pages are served by the local proxy,
			// they remain same-origin and we can read iframe.contentWindow.location.search to get the original URL.
			iframe.addEventListener('load', ()=>{
				try{
					const loc = iframe.contentWindow.location.href;
					// If we are on /proxy?url=..., extract the url param
					const u = extractOriginalFromProxied(loc) || historyStack[historyIndex] || '';
					address.value = u;
					status.textContent = 'Loaded';
					// If navigation wasn't programmatic (e.g., user clicked an internal link), push to history
					if(!isNavigatingProgrammatically){
						historyStack = historyStack.slice(0, historyIndex + 1);
						historyStack.push(u);
						historyIndex = historyStack.length - 1;
						updateNavButtons();
					}
				}catch(err){
					// Cross-origin would throw, but our proxy serves same-origin pages.
					console.warn('iframe load handler error', err);
				}
				isNavigatingProgrammatically = false;
			});

			function extractOriginalFromProxied(href){
				try{
					const u = new URL(href, location.href);
					if(u.pathname === '/proxy'){
						const orig = u.searchParams.get('url');
						return orig ? decodeURIComponent(orig) : null;
					}
					return null;
				}catch(e){return null}
			}

			// Quick startup
			navigateTo(HOME_URL, true);
		</script>
	</body>
</html>
